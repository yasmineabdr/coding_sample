---
title: Wine Analysis 
subtitle: Report
author: team_e
execute:
  echo: true
---

Red Wine Quality Analysis

Yasmine Abdel-Rahman, Frankie Stillo, Theo Prosise

### **Introduction and Data**

Wine is a commodity integral to the United States. It contributes over 276 billion dollars to the United States gross domestic product (GDP) accounting for nearly 1.3% of the GDP in 2022^1^. The wine industry employs over 1 million US citizens generating nearly 40.1 billion dollars in wages annually^2^. It is a staple of not just the US economy but internationally as well responsible for 400 billion dollars in revenue each year which includes the millions of tourists that travel seeking quality wine^3^. Hence, illuminating what makes a wine quality and reproducible has been subject to many studies. Previous studies have investigated the influence of grape variety, time, terroir, winemaking techniques, and aging and fermentation conditions on the quality and rating of wine, however, less investigated is the wine's chemical makeup at the time of consumption. This study aims to investigate the chemical compositions, qualities and other physicochemical measures of red wine that contribute to a high-rating of a wine connoisseur. The data^4^ used in this analysis was obtained solely from Vinho Verde wines which are wines created from Northwest Portugal. The chemical data was obtained prior to the certification of wine. Certification is a process that ensures the wine is safe for human consumption and determines the quality of the wine for sale and consumption. The dataset contains 12 numerical variables and 1,599 observations each representing a bottle of wine. The variables contained within the dataset and their descriptions are visible in Figure 1. The dataset is ordered and not balanced meaning that there are more average rated wines than high and low quality wines. This project aims to produce a model that can accurately predict wine quality based on chemical properties. According to Dr. Jamie Goode, a wine researcher and journalist,

""\[In winemaking\] acidity is most crucial. It provides structure, balance, and freshness, ensuring that a wine doesn't taste flabby or overly sweet. Acidity is like the backbone of a wine; without it, a wine lacks definition and vitality.^5^"

An aspect of this dataset worth investigating further is the correlation between pH levels and wine ratings. Developing analytical models to discern the relationship between pH and wine scores, alongside examining the chemical composition's impact on pH, holds promise for enhancing comprehension of wine quality through a chemical perspective.

**Our research question is:** Which factors and properties can accurately predict the quality of wine?

**Figure 1**

```{r}
#| label: figure-1 
#| echo: false
#| message: false

library(tidyverse)
library(tidymodels)
library(dplyr)
library(knitr)


red_wine <- read.csv2("data/winequality-red.csv")

red_wine_v2 <- red_wine |>
  mutate(across(everything(), as.numeric))


measure <- c("fixed.acidity", "volatile.acidity", "citric.acid", "residual.sugar", 
              "chlorides", "free.sulfur.dioxide", "total.sulfur.dioxide", 
              "density", "pH", "sulphates", "alcohol", "quality")

units <- c("g(tartaric acid)/dm³", 
           "g(acetic acid)/dm³", 
           "g/dm³", 
           "g/dm³", 
           "g(sodium chloride)/dm³", 
           "mg/dm³", 
           "mg/dm³", 
           "g/cm³", 
           NA, 
           "g(potassium sulphate)/dm³",
           "vol.%",
           NA)

means <- red_wine |>
  summarise_all(~mean(as.numeric(.))) |>
  pivot_longer(cols = everything(), names_to = "variable", values_to = "mean")

# i was not able to find a way to summarize means and sd in one pipeline / please change if you are able

sd <- red_wine |>
  summarise_all(~sd(as.numeric(.))) |>
  pivot_longer(cols = everything(), names_to = "variable", values_to = "sd")

means_sd <- right_join(means, sd, by = c("variable" = "variable")) 

descriptions <- c("wine's natural acids", "measure of the wine's gaseous acids that contributes to the smell and taste of vinegar in wine", "Boosts the acidity of wine during fermentation", "natural grape sugars left in a wine after the alcoholic fermentation finishes.", " adds to the saltiness of a wine", "helps protect the wine from oxidation and spoilage","portion of SO~2~ that is free in the wine plus the portion that is bound to other chemicals in the wine", "helps determine the alcohol content level of the final wine", " can affect aroma, flavor, carbon dioxide absorption, tartrate precipitation, color, age-ability, fermentation rate, stability, and malolactic fermentation", " food preservative used to maintain the flavor and freshness of wine", "Alcohol Content", "Score given by experts")
  
variable_description <- data.frame(measure = measure, units = units, descriptions = descriptions) 

variable_description_v2 <- right_join(means_sd, variable_description, by = c("variable" = "measure")) 

kable(variable_description_v2, digits = 3, caption = "Chemical descriptions and units^6^")

```

### **Methodology**

#### **RStudio Analysis**

RStudio was used for the analytical portion of this study and collaboration was facilitated through the use of GitHub.

The following R packages were utilized for data manipulation, statistical analysis, and presentation:

-   **tidymodels**: A collection of packages for modeling using the tidyverse principles.

-   **tidyverse**: A collection of packages for data manipulation and visualization.

-   **dplyr**: A package for data manipulation and transformation.

-   **knitr**: A package for dynamic report generation in R Markdown

#### **Regression Model Specification**

Linear regression models were constructed to predict wine quality based on various physicochemical factors. The response variable, quality, was treated as continuous, aligning with the ordinal nature of the quality scores assigned by experts. Predictor variables considered included fixed acidity, volatile acidity, citric acid, residual sugar, chlorides, free sulfur dioxide, total sulfur dioxide, density, pH, sulphates, and alcohol content.

An interactive method was chosen as each predictor has confounding effects on items such as alcohol %, density, and pH. An interactive model would account for these differences by examining the relationship between predictors. In the case of our data, our variables affect the outcome of the red wine.

A trial and error method was used to determine the chosen models. For the top predictors model, we chose the variables based off a research paper^6^ published with the data set. Via experimentation with the variables, models with high-predictor statistics were selected for further analysis.

#### **Model Fitting**

Three of our top models were fitted to the data for analysis: 

1.  Volatile Acidity and Alcohol Content Model (vol-aciditiy-alc%-model):

    -   This model fits a linear regression model predicting wine quality based on volatile acidity and alcohol content.

2.  Top Predictors Model (mix-model):

    -   This model does an interactive linear regression predicting quality from sulphates, pH, total sulfur dioxide, and alcohol.

3.  All Predictors Model (all-model):

    -   This model fits a linear regression model using all available chemical predictors, including volatile acidity, fixed acidity, citric acid, residual sugar, chlorides, free sulfur dioxide, total sulfur dioxide, and sulfates.Note that this does not include density, alcohol%, or pH.

To do a comparative statistical analysis, adjusted R^2^ and R^2^ were used. These predictor statistics were chosen as they quantify the proportion of variance in the response variable that is explained by the predictor variables in the regression model which is exactly what this study aims to uncover. The tidy() and glance() functions were used to provide statistical summaries and model evaluation metrics, facilitating the interpretation of the regression results.

### **Results:**

Our top model based on adjusted R^2^ was our second model, the mix model. This model's adjusted R^2^ value was 0.399, which was the highest of all the models we tested. This makes sense, as it parallels what was said in the research paper of the data set. What we have found helps answer our own research question: Which factors and properties can accurately predict the quality of wine?

The interactive nature of the model helps predict the quality of the wine as it takes into account how each variable interacts with the other. They do not exist in isolation. This interaction can be modeled by the equation.

**Equation:**

$$
\begin{align*}
\hat{y} = & -696.7092 + 882.2127 \times \text{sulphates} + 211.4495 \times \text{pH} + 6.9559 \times \text{total sulfur} \\
          & + 68.9782 \times \text{alcohol} + 1445.558 \times \text{volatile acidity} \\
          & + 6533.450 \times \text{chlorides} - 268.4295 \times (\text{sulphates} \times \text{pH}) \\
          & - 86.2912 \times (\text{sulphates} \times \text{alcohol}) - 20.7689 \times (\text{pH} \times \text{alcohol}) - \ldots
\end{align*}
$$

Due to the complex nature of the interactive model, the entirety of the equation is too long to be put. Instead, the beginning of the equation is put to show the interactions between the beginning predictors. The remainder of the equation can be simply obtained using information taken from Figure 3.

#### **Model Outcomes**

The model outcomes show our top three models, including the one with the highest adjusted R^2.^

**Figure 2:** acidity-alc% Fit: Linear regression model predicting wine quality based on volatile acidity and alcohol content

```{r}
#| label: vol-aciditiy-alc%-model 
#| echo: false
#| message: false

wine_lin_fit2 <- linear_reg() |>
  fit(quality ~ volatile.acidity * alcohol, data = red_wine_v2)

tidy(wine_lin_fit2) |>
  kable(digits = 4)

glance(wine_lin_fit2)$r.squared |>
  kable(col.names = c("R Squared"), digits = 3)
glance(wine_lin_fit2)$adj.r.squared |>
  kable(col.names = c("Adjusted R Squared"), caption = "Volatile Acidity and Alcohol Content Model", digits = 3)

```

**Figure 3:** Mix Fit: This model does an additive linear regression predicting quality from sulphates, pH, total sulfur dioxide, and alcohol.

```{r}
#| label: mix-model 
#| echo: false
#| message: false

mix_lin_fit2 <- linear_reg() |>
  fit(quality ~ sulphates * pH * total.sulfur.dioxide * alcohol * volatile.acidity * chlorides, data = red_wine_v2)

tidy(mix_lin_fit2) |>
  kable(digits = 3)

glance(mix_lin_fit2)$r.squared |>
  kable(col.names = c("R Squared"), digits = 3)
glance(mix_lin_fit2)$adj.r.squared |>
  kable(col.names = c("Adjusted R Squared"), caption = "Mix Model, ", digits = 3)
```

**Figure 4:** All-Predictors Fit: This model does an additive linear regression using every chemical variable:

```{r}
#| label: all-model 
#| echo: false
#| message: false

all_fit<- linear_reg() |>
  fit(quality ~ volatile.acidity * fixed.acidity * citric.acid * residual.sugar * chlorides * free.sulfur.dioxide * total.sulfur.dioxide * sulphates, data = red_wine_v2)

glance(all_fit)$r.squared |>
  kable(col.names = c("R Squared"), digits = 3)
glance(all_fit)$adj.r.squared |>
  kable(col.names = c("Adjusted R Squared"), caption = "Volatile Acidity and Alcohol Content Model", digits = 3)
```

### **Discussion**

In conclusion, looking at the variables of red wine and how those can predict its quality led us to explore different combinations of predictors and their outcomes. Using linear regression models and their adjusted R^2^ values, we were able to come up with our best model that predicts the quality of red wine.

In addition, our analysis does have some limitations. Although we tried to use as many different combinations of predictive variables that we could, there were only so many that we could use. In addition, we couldn't fit the interactive model's output for the last model due to its length. This points to a limitation in our work: the factors that led to which predictors we would use had to do with the logistics of being able to include it in our write-up and presentation, and what value it brought to out analysis.

One way our analysis could be improved is by comparing additive and interactive models. In this write-up, we only included interactive models as the variables in the data set interacted with one another to determine wine quality. However, comparing additive to interactive linear regression models could provide key insights on how the variables interact with each other that is missing in this analysis.

Using this analysis, future work can build off of the red wine data set. We also had access to a white wine data set, and looking at the interactions between those two would have opened up a whole new world of possibilities in terms of comparing predictive values to determine wine quality. Unfortunately, the same limitation came up that we did not have the space or time to complete them, but future work may include comparing white wine to red wine, and determing which may be easier to produce at a high quality.

### **References**

1.  Economic impact study of the American wine industry. WineAmerica. (2022, October 27). [https://wineamerica.org/economic-impact-stud](https://wineamerica.org/economic-impact-study/#:~:text=The%20Wine%20Industry%20Boosts%20the,billion%20in%20total%20economic%20activity.)y

2.  Dunham, J. (2022, September 21). *2022 economic impact study of the American wine industry methodology*. Wine-America. https://wineamerica.org/economic-impact-study/2022-american-wine-industry-methodology

3.  Published Jan Conway, & 3, A. (2024, April 3). *Global: Wine market size 2018-2028*. Statista. https://www.statista.com/statistics/922403/global-wine-market-size/

4.  Cortez, Paulo, Cerdeira, A., Almeida, F., Matos,T., and Reis,J.. (2009). Wine Quality. UCI Machine Learning Repository. <https://doi.org/10.24432/C56S3T.>

5.  Goode, J. (2021). *The science of wine: From vine to glass*. University of California Press.

6.  Cortez, P. et al. "Modeling wine preferences by data mining from physicochemical properties." Decis. Support Syst. 47 (2009): 547-553.
